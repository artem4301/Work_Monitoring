# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–∞—É–∑–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ –∑–æ–Ω—ã (–∑–∞–∫—Ä—ã—Ç–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)

## –ü—Ä–æ–±–ª–µ–º–∞

–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–∫—Ä—ã–≤–∞–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –≤—ã—Ö–æ–¥–∏–ª –∏–∑ —Ä–∞–±–æ—á–µ–π –∑–æ–Ω—ã, –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
- ‚ùå –¢–∞–π–º–µ—Ä –ø—Ä–æ–¥–æ–ª–∂–∞–ª –∏–¥—Ç–∏
- ‚ùå –°—Ç–∞—Ç—É—Å –ø–æ–∫–∞–∑—ã–≤–∞–ª "–í–Ω–µ —Ä–∞–±–æ—á–µ–π –∑–æ–Ω—ã", –Ω–æ –ø–∞—É–∑–∞ –Ω–µ –ø—Ä–∏–º–µ–Ω—è–ª–∞—Å—å
- ‚ùå –í—Ä–µ–º—è –≤–Ω–µ –∑–æ–Ω—ã –∑–∞—Å—á–∏—Ç—ã–≤–∞–ª–æ—Å—å –∫–∞–∫ —Ä–∞–±–æ—á–µ–µ

## –ü—Ä–∏—á–∏–Ω–∞

–ü—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `wasInZone` —Å–±—Ä–∞—Å—ã–≤–∞–ª–∞—Å—å, –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –º–æ–≥–ª–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, —á—Ç–æ —Å—Ç–∞—Ç—É—Å –∑–æ–Ω—ã –∏–∑–º–µ–Ω–∏–ª—Å—è –≤–æ –≤—Ä–µ–º—è –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–í `WorkTimeActivity.loadShiftData()` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–µ–∫—É—â–µ–≥–æ —Å—Ç–∞—Ç—É—Å–∞:

```kotlin
// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –∑–æ–Ω—ã –∏ –ø—Ä–∏–º–µ–Ω—è–µ–º –ª–æ–≥–∏–∫—É –ø–∞—É–∑—ã
repository.getWorkerLocationStatus(userId) { inZone ->
    runOnUiThread {
        // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–Ω–µ –∑–æ–Ω—ã –∏ —Å–º–µ–Ω–∞ –Ω–µ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞, –ø—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º
        if (!inZone && !isShiftPaused) {
            repository.pauseShift(userId, "–í—ã—Ö–æ–¥ –∏–∑ —Ä–∞–±–æ—á–µ–π –∑–æ–Ω—ã") { success ->
                if (success) {
                    Toast.makeText(this@WorkTimeActivity, "–°–º–µ–Ω–∞ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞: –≤—ã—Ö–æ–¥ –∏–∑ —Ä–∞–±–æ—á–µ–π –∑–æ–Ω—ã", Toast.LENGTH_LONG).show()
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                    isShiftPaused = true
                    pauseStartTime = System.currentTimeMillis()
                }
            }
        }
        // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –∑–æ–Ω–µ –∏ —Å–º–µ–Ω–∞ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ø–æ –ø—Ä–∏—á–∏–Ω–µ –≤—ã—Ö–æ–¥–∞ –∏–∑ –∑–æ–Ω—ã, –≤–æ–∑–æ–±–Ω–æ–≤–ª—è–µ–º
        else if (inZone && isShiftPaused && user.pauseReason == "–í—ã—Ö–æ–¥ –∏–∑ —Ä–∞–±–æ—á–µ–π –∑–æ–Ω—ã") {
            repository.resumeShift(userId) { success ->
                if (success) {
                    Toast.makeText(this@WorkTimeActivity, "–°–º–µ–Ω–∞ –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∞: –≤–æ–∑–≤—Ä–∞—Ç –≤ —Ä–∞–±–æ—á—É—é –∑–æ–Ω—É", Toast.LENGTH_SHORT).show()
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                    isShiftPaused = false
                    totalPauseDuration += (System.currentTimeMillis() - pauseStartTime)
                    pauseStartTime = 0L
                }
            }
        }
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –∫–∞–∫ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
        wasInZone = inZone
    }
}
```

### 2. –§–æ–Ω–æ–≤–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤ LocationTrackingService

–î–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø–∞—É–∑—ã –≤ `LocationTrackingService`:

```kotlin
private fun handleZoneStatusChange(currentlyInZone: Boolean) {
    val userId = FirebaseAuth.getInstance().currentUser?.uid ?: return
    
    repository.getCurrentUser { user ->
        if (user != null) {
            if (!currentlyInZone && user.shiftPaused != true) {
                // –í—ã—à–µ–ª –∏–∑ –∑–æ–Ω—ã –∏ —Å–º–µ–Ω–∞ –Ω–µ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ - –ø—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º
                repository.pauseShift(userId, "–í—ã—Ö–æ–¥ –∏–∑ —Ä–∞–±–æ—á–µ–π –∑–æ–Ω—ã") { success ->
                    if (success) {
                        Log.d("LocationService", "–°–º–µ–Ω–∞ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞: –≤—ã—Ö–æ–¥ –∏–∑ —Ä–∞–±–æ—á–µ–π –∑–æ–Ω—ã")
                        updateNotification()
                    }
                }
            } else if (currentlyInZone && user.shiftPaused == true && user.pauseReason == "–í—ã—Ö–æ–¥ –∏–∑ —Ä–∞–±–æ—á–µ–π –∑–æ–Ω—ã") {
                // –í–µ—Ä–Ω—É–ª—Å—è –≤ –∑–æ–Ω—É –∏ —Å–º–µ–Ω–∞ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ø–æ –ø—Ä–∏—á–∏–Ω–µ –≤—ã—Ö–æ–¥–∞ –∏–∑ –∑–æ–Ω—ã - –≤–æ–∑–æ–±–Ω–æ–≤–ª—è–µ–º
                repository.resumeShift(userId) { success ->
                    if (success) {
                        Log.d("LocationService", "–°–º–µ–Ω–∞ –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∞: –≤–æ–∑–≤—Ä–∞—Ç –≤ —Ä–∞–±–æ—á—É—é –∑–æ–Ω—É")
                        updateNotification()
                    }
                }
            }
        }
    }
}
```

### 3. –£–ª—É—á—à–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

–û–±–Ω–æ–≤–ª–µ–Ω –º–µ—Ç–æ–¥ —Å–æ–∑–¥–∞–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –ø–∞—É–∑—ã:

```kotlin
private fun createNotification(): android.app.Notification {
    val userId = FirebaseAuth.getInstance().currentUser?.uid
    var notificationText = if (isInZone) "–í—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –≤ —Ä–∞–±–æ—á–µ–π –∑–æ–Ω–µ: $workZoneAddress" else "–í—ã –≤–Ω–µ —Ä–∞–±–æ—á–µ–π –∑–æ–Ω—ã"
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –ø–∞—É–∑—ã –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    if (userId != null) {
        repository.getCurrentUser { user ->
            if (user?.shiftPaused == true) {
                val reason = user.pauseReason ?: "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞"
                notificationText = "–°–º–µ–Ω–∞ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞: $reason"
            }
        }
    }
    
    return NotificationCompat.Builder(this, CHANNEL_ID)
        .setContentTitle("–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è")
        .setContentText(notificationText)
        // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        .build()
}
```

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

### ‚úÖ –¢–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ:

1. **–ü—Ä–∏ –∑–∞–∫—Ä—ã—Ç–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:**
   - `LocationTrackingService` –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –≤—ã—Ö–æ–¥ –∏–∑ –∑–æ–Ω—ã
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–º–µ–Ω—É
   - –û–±–Ω–æ–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

2. **–ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:**
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –∑–æ–Ω—ã
   - –ü—Ä–∏–º–µ–Ω—è–µ—Ç –ø–∞—É–∑—É, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–Ω–µ –∑–æ–Ω—ã
   - –í–æ–∑–æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–º–µ–Ω—É –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –≤ –∑–æ–Ω—É

3. **–¢–æ—á–Ω—ã–π —É—á–µ—Ç –≤—Ä–µ–º–µ–Ω–∏:**
   - –í—Ä–µ–º—è –≤–Ω–µ –∑–æ–Ω—ã –Ω–µ –∑–∞—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è
   - –ü–∞—É–∑—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ Firebase
   - –¢–∞–π–º–µ—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–µ —Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è

## üì± –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –í—ã—Ö–æ–¥ –∏–∑ –∑–æ–Ω—ã –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –∑–æ–Ω–µ ‚úÖ
2. –ó–∞–∫—Ä—ã–≤–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ üì±
3. –í—ã—Ö–æ–¥–∏—Ç –∏–∑ —Ä–∞–±–æ—á–µ–π –∑–æ–Ω—ã üö∂‚Äç‚ôÇÔ∏è
4. `LocationTrackingService` –ø—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–º–µ–Ω—É ‚è∏Ô∏è
5. –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤–∏–¥–∏—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Å—Ç–∞—Ç—É—Å ‚úÖ

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –í–æ–∑–≤—Ä–∞—Ç –≤ –∑–æ–Ω—É –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–Ω–µ –∑–æ–Ω—ã, —Å–º–µ–Ω–∞ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ ‚è∏Ô∏è
2. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ üì±
3. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ —Ä–∞–±–æ—á—É—é –∑–æ–Ω—É üè¢
4. `LocationTrackingService` –≤–æ–∑–æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–º–µ–Ω—É ‚ñ∂Ô∏è
5. –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤–∏–¥–∏—Ç –∞–∫—Ç–∏–≤–Ω—É—é —Å–º–µ–Ω—É ‚úÖ

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –û—Ç–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤–Ω–µ –∑–æ–Ω—ã
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–Ω–µ –∑–æ–Ω—ã üö∂‚Äç‚ôÇÔ∏è
2. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ üì±
3. `WorkTimeActivity` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å ‚ö°
4. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–º–µ–Ω—É ‚è∏Ô∏è
5. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø–∞—É–∑–µ üì¢

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –î–≤–æ–π–Ω–∞—è –∑–∞—â–∏—Ç–∞:
- **–§–æ–Ω–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å** - —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ** - –ø–æ–¥—Å—Ç—Ä–∞—Ö–æ–≤–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:
- –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ Firebase
- –õ–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç—Ä–∞–∂–∞—é—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
- –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ –ª–æ–≥
- –£–ø—Ä–æ—â–∞–µ—Ç –æ—Ç–ª–∞–¥–∫—É –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- –ü–æ–º–æ–≥–∞–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å–µ—Ä–≤–∏—Å–∞ 